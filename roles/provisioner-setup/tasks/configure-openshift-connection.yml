---
- name: Get provisioner token
  command: >-
    oc serviceaccounts get-token -n default provisioner
  changed_when: false
  register: get_provisioner_token

- name: Save provisioner token with ansible-vault
  command: >-
    ansible-vault encrypt --vault-password-file={{ vault_password_file }}
    --output={{ cluster_config_path }}/openshift-connection.yml
  args:
    stdin: |-
      openshift_connection_certificate_authority: {{ cluster_config_path }}/tls/master-ca.crt
      openshift_connection_server: https://{{ openshift_master_cluster_public_hostname }}/
      openshift_connection_token: {{ get_provisioner_token.stdout | to_json }}
  delegate_to: localhost
  register: encrypt_provisioner_token
