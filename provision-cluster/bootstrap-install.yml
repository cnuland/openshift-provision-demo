---
- name: Wait for Instances
  hosts: OSEv3
  gather_facts: false
  tasks:
  - name: Wait for connection to instances
    wait_for_connection:
      connect_timeout: 20
      sleep: 5
      delay: 5
      timeout: 300

- name: Prepare OSEv3 Hosts
  hosts: OSEv3
  vars:
    terraform_dir: "{{ playbook_dir }}/terraform"
  pre_tasks:
  - name: Load cluster config
    import_tasks: ../load-config.yml
  roles:
  - role: node-prep

- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/prerequisites.yml
# OCP 3.10
- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/openshift-checks/pre-install.yml
# OCP 3.10
- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/openshift-node/bootstrap.yml
- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/openshift-etcd/config.yml
#- import_playbook: >-
#    {{ openshift_ansible_location }}/playbooks/openshift-nfs/config.yml
#- import_playbook: >-
#    {{ openshift_ansible_location }}/playbooks/openshift-loadbalancer/config.yml
- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/openshift-master/config.yml
- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/openshift-master/additional_config.yml
# OCP 3.10
- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/openshift-node/join.yml
# OCP 3.9
#- import_playbook: >-
#    {{ openshift_ansible_location }}/playbooks/openshift-node/config.yml
