---
- name: Wait for Instances
  hosts: OSEv3
  gather_facts: false
  tasks:
  - name: Wait for connection to instances
    wait_for_connection:
      connect_timeout: 20
      sleep: 5
      delay: 5
      timeout: 300

- name: Prepare OSEv3 Hosts
  hosts: OSEv3
  pre_tasks:
  - name: Load cluster config
    import_tasks: ../load-config.yml
  roles:
  - role: node-prep

- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/prerequisites.yml

# Import playbook list from openshift-ansible/playbooks/deploy_cluster.yml
- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/init/main.yml
  vars:
    l_networkman_check_hosts: "oo_nodes_to_config"

- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/openshift-checks/private/install.yml

- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/openshift-node/private/bootstrap.yml

- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/common/private/control_plane.yml

- import_playbook: >-
    {{ openshift_ansible_location }}/playbooks/openshift-node/private/join.yml
